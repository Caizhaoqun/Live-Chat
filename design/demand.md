# Live-Chat需求分析

### 主页加载
- 加载用户的聊天列表
- 加载用户正在聊天的对象
- 如果用户正在群聊，加载用户最后20条聊天记录
- 如果用户正在私聊，加载当前聊天对象的最后20条聊天记录

### 在线用户
点击任意一个在线用户，首先判断用户是在聊天列表中

- 如果在，将聊天对象切换成该用户，并发送ajax请求，更改该用户的正在聊天的对象
- 如果不在，将该用户添加到聊天列表，将聊天对象切换成该用户，并发送Ajax请求，更改数据库中该用户正在聊天的对象，并添加到聊天用户列表。

### 聊天列表
- 登录成功或者刷新页面之后，如果加载好的聊天列表不为空，需要添加到聊天列表中去，这时候需要判断每一个用户是不是离线，如果是离线，将用户的头像灰色显示。
- 对于当前聊天对象，需要加背景或者其他css属性来标明
- 点击聊天用户列表中的某一个用户，需要将聊天对象的名字切换成该用户的名字，并发送Ajax请求，更改数据库中该用户正在聊天的对象。
- 键盘切换聊天用户，如果同时点击Ctrl键和Tab键，更改当前聊天对象为下一个聊天对象，将聊天对象的名字改成下一个用户的名字；发送Ajax请求，更改数据库中该用户正在聊天的对象。
- 点击用户右上角的`X`，删除当前聊天对象，将聊天对象切换成下一个聊天对象，如果该用户是最后一个聊天对象，将当前聊天对象切换成群聊；发送Ajax请求，更改数据库中该用户的聊天列表。

### 发送消息
- 按下键盘的任意键，将焦点切换成输入框
- 如果用户点击Enter键,首先需要判断用户是否登录，如果登录了，可以直接发送消息，如果没有登录，弹出提示框，告诉用户应该先登录
- 如果聊天对象不在线，发送的时候应该提示该用户不在线，发送的消息可能无法送达，发送的消息存入发送对方 的离线消息列表中


### 登录注册
- 用户登录有两种方式
    - 使用用户名和密码登录
    - 使用第三方登录：Github、微博、QQ
- 用户注册需要填写昵称、邮箱(用于生成头像)、密码，同时还可以选择性上传头像

### 消息通知
- 用户上线或者刷新页面的时候，如果有未读消息，应该在消息来源的用户右上角显示红色数字。分成两种情况
    - 如果离线消息来源用户不在聊天列表中，那么将其添加到聊天列表，并且显示离线消息。如果离线消息来源用户不止一个，最后一个直接显示消息，其余的在用户头像右上方显示未读消息数目
    - 如果离线消息来源用户在聊天列表中，并且只有一个来源用户，直接将正在聊天对象切换到该用户，并且显示离线消息；否则，和上面情况一样。
- 正在聊天的过程中，如果有新消息来，需要进行通知，同样分成两种情况：
    - 消息来源用户在聊天列表中，在该用户头像右上角显示消息数目
    - 消息来源用户不在聊天列表中，在在线用户列表中在该用户的头像上显示消息数目

### 聊天记录
- 点击聊天列表中的用户，除了切换聊天对象之外，将聊天窗口中的聊天记录切换成与该用户的聊天记录，如果该用户已经是当前聊天对象，不需要执行动作
- 在加载好的20条记录最顶端，显示加载更过聊天记录按钮，点击该按钮或者鼠标网上滚动，请求之前的20条聊天记录，之后的动作以此类推